---
layout: 
title: "Danh sách bài hát"
permalink: /songs
description: "Hiển thị các bài hát karaoke đã được chọn để hát. Dễ dàng truy cập và quản lý các lựa chọn yêu thích của bạn."
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Karaoke Player with WebRTC & Firebase Sync</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body class="bg-gray-100 text-center">
  <h1 class="text-2xl font-bold">Karaoke Player with Real-time Sync</h1>
  <div id="player" class="my-4 mx-auto"></div>
  <div class="space-x-4">
    <button id="playBtn" class="px-4 py-2 bg-green-500 text-white">Play</button>
    <button id="pauseBtn" class="px-4 py-2 bg-yellow-500 text-white">Pause</button>
    <button id="volumeUpBtn" class="px-4 py-2 bg-blue-500 text-white">Volume Up</button>
    <button id="volumeDownBtn" class="px-4 py-2 bg-blue-500 text-white">Volume Down</button>
    <button id="replayBtn" class="px-4 py-2 bg-purple-500 text-white">Replay</button>
  </div>

<script type="text/javascript">
    const firebaseConfig = {
      apiKey: "AIzaSyBBPKJcXjkZ0wUbXNremQuf_R1Z6baYcU0",
      authDomain: "karaoke-3aa8f.firebaseapp.com",
      databaseURL: "https://karaoke-3aa8f-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId: "karaoke-3aa8f",
      storageBucket: "karaoke-3aa8f.appspot.com",
      messagingSenderId: "652741363415",
      appId: "1:652741363415:web:e33bb49a0be7eed7e09292",
      measurementId: "G-MNBY4YPT3N"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let player;
    let isSyncing = false;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '390',
        width: '640',
        videoId: 'rM5iazNj9mw',
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function syncVideoWithFirebase() {
      const videoRef = database.ref('videoState');
      videoRef.on('value', (snapshot) => {
        const data = snapshot.val();
        if (data && !isSyncing) {
          isSyncing = true;
          player.seekTo(data.currentTime, true);
          if (data.isPlaying) {
            player.playVideo();
          } else {
            player.pauseVideo();
          }
          isSyncing = false;
        }
      });
    }

    function updateFirebase() {
      if (!isSyncing) {
        database.ref('videoState').set({
          currentTime: player.getCurrentTime(),
          isPlaying: player.getPlayerState() === YT.PlayerState.PLAYING
        });
      }
    }

    function onPlayerReady(event) {
      syncVideoWithFirebase();
      player.playVideo(); // Tự động phát video khi trang được truy cập
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING || event.data === YT.PlayerState.PAUSED) {
        updateFirebase();
      }
    }

    $('#playBtn').click(function() {
      player.playVideo();
      updateFirebase();
    });

    $('#pauseBtn').click(function() {
      player.pauseVideo();
      updateFirebase();
    });

    $('#volumeUpBtn').click(function() {
      player.setVolume(Math.min(player.getVolume() + 10, 100)); // Đảm bảo âm lượng không vượt quá 100
    });

    $('#volumeDownBtn').click(function() {
      player.setVolume(Math.max(player.getVolume() - 10, 0)); // Đảm bảo âm lượng không dưới 0
    });

    $('#replayBtn').click(function() {
      player.seekTo(0);
      updateFirebase();
    });

    const peerConnection = new RTCPeerConnection();
    const dataChannel = peerConnection.createDataChannel('sync');
    
    dataChannel.onopen = () => {
      console.log('DataChannel is open');
      setInterval(() => {
        const videoState = {
          currentTime: player.getCurrentTime(),
          isPlaying: player.getPlayerState() === YT.PlayerState.PLAYING
        };
        if (dataChannel.readyState === 'open') {
          dataChannel.send(JSON.stringify(videoState));
        }
      }, 1000);
    };

    dataChannel.onclose = () => {
      console.log('DataChannel is closed');
    };

    peerConnection.ondatachannel = (event) => {
      const channel = event.channel;
      channel.onmessage = (event) => {
        const data = JSON.parse(event.data);
        player.seekTo(data.currentTime, true);
        if (data.isPlaying) {
          player.playVideo();
        } else {
          player.pauseVideo();
        }
      };
    };
</script>
</body>
</html>


