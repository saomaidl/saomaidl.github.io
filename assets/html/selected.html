<div class="w_Qz6x mobile-modal">
  <div data-focus-guard="true" tabindex="0" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div>
  <div data-focus-lock-disabled="false" class="w_hPDp">
    <div class="w_32Rp">
      <div class="w_m4hJ" role="dialog">
        <div class="w_iMLF">
          <button aria-label="Close dialog" class="w_Rfk5 customClose" type="button" onclick="window.location.href='https://saomaidl.github.io/songs';">
            <svg fill="currentColor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" style="font-size: 1.5rem; vertical-align: -0.25em;">
              <path fill-rule="evenodd" d="M3.05 3.05a.5.5 0 0 1 .707 0L8 7.293l4.243-4.243a.5.5 0 0 1 .707.707L8.707 8l4.243 4.243a.5.5 0 0 1-.707.707L8 8.707 3.757 12.95a.5.5 0 0 1-.707-.707L7.293 8 3.05 3.757a.5.5 0 0 1 0-.707Z"></path>
            </svg>
          </button>
          <h2 class="w_d_KY">CHỌN BÀI THÀNH CÔNG</h2>
        </div>
        <div class="w_iu_y">
          <div class="w_tGqM">
            <div style="margin-top: 0px;">
              <div class="splashSection static w-100 mt0" style="background-color: rgb(4, 30, 66);padding-bottom: 0px;">
                <div class="tc mt1" style="padding: 0px 20px 48px;">
                  <h3 class="mt0 mb0 f3 normal white mb1" style="font-family:'saomai';">CẢM ƠN QUÝ KHÁCH ĐÃ CHỌN</h3>
                  <div class="mt2">
                    <h3 class="text-[32px] inline-flex gap-[2px] items-center justify-center" style="letter-spacing:-.1rem;">
                      <div class="white">Saomai</div>
                      <a link-identifier="saomaiLogoMobile" class="gold h-[32px] w-[32px] flex" aria-hidden="false" aria-label="Sao Mai Homepage" data-automation-id="header-link-saomaiLogo" href="/"><i class="ld ld-Spark" style="font-size:2rem;vertical-align:-0.325em;width:2rem;height:2rem;box-sizing:content-box" aria-hidden="true"></i></a>
                      <div class="white font-normal" style="font-family: 'saomai';">Karaoke</div>
                    </h3>
                  </div>
                  <div class="mt4 text-xl mb3">
                    <div class="white inline-flex gap-[4px] items-center justify-center flex-col">
                      <div>
                        <span>ĐANG CÒN</span>
                        <span id="song_status" style="color: rgb(128, 184, 238);"></span>
                        <span>BÀI,</span>
                      </div>
                      <div>SẴN SÀNG NHÉ</div>
                    </div>
                  </div>
                  <button class="w_eEg0 w_OoNT w_4QgR mt5 w-100" type="button" data-testid="playlist" onclick="window.location.href='https://saomaidl.github.io/songs';">XEM DANH SÁCH PHÁT</button>
                </div>
              </div>
            </div>
            <div class="overlayDiv" aria-hidden="true" data-testid="splash-overlay"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="w_NOPS w_C76E"></div>
  </div>
  <div data-focus-guard="true" tabindex="0" style="width: 1px; height: 0px; padding: 0px; overflow: hidden; position: fixed; top: 1px; left: 1px;"></div>
</div>
  <script type="module">
import { ref, get } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js';
import { auth, realTimeDb } from './firebase-config.js';

async function getUserIndexById() {
    try {
        // Lấy thông tin người dùng hiện tại
        const user = auth.currentUser;
        if (!user) {
            console.error("User is not logged in.");
            return -1; // Người dùng chưa đăng nhập
        }

        const userId = user.uid; // Lấy id của người dùng hiện tại

        // Lấy dữ liệu từ Realtime Database
        const usersRef = ref(realTimeDb, 'users');
        const snapshot = await get(usersRef);

        if (snapshot.exists()) {
            const usersData = snapshot.val();
            
            // Chuyển dữ liệu từ object thành mảng để dễ thao tác
            const usersArray = Object.keys(usersData).map(key => ({
                uid: key,
                ...usersData[key]
            }));

            // Lọc những người có played là false
            const filteredUsers = usersArray.filter(user => !user.played);

            // Sắp xếp theo priority và timestamp
            filteredUsers.sort((a, b) => {
                // Sắp xếp theo priority (true trước)
                if (a.priority !== b.priority) {
                    return b.priority - a.priority; // true (1) đứng trước false (0)
                }
                // Nếu priority giống nhau thì sắp xếp theo timestamp
                return a.timestamp - b.timestamp;
            });

            // Tìm index của người dùng với id cụ thể
            const userIndex = filteredUsers.findIndex(user => user.uid === userId);

            // Trả về index (vị trí) của người dùng
            return userIndex;
        } else {
            console.error("No users found in the database.");
            return -1; // Không tìm thấy người dùng
        }
    } catch (error) {
        console.error("Error getting user data:", error);
        return -1; // Xảy ra lỗi
    }
}

// Gọi hàm để lấy index của người dùng hiện tại
getUserIndexById().then(index => {
    if (index !== -1) {
        console.log(`User index: ${index}`);
    } else {
        console.log("User not found or an error occurred.");
    }
});

  </script>
