<!DOCTYPE html>
<html>
<head>
  <title>Firebase Authentication</title>
</head>
<body>
  <div id="recaptcha-container"></div>

  <input type="text" id="phone-number" placeholder="Nhập số điện thoại" />
  <button id="send-code-btn">Gửi mã</button>

  <input type="text" id="verification-code" placeholder="Nhập mã xác minh" />
  <button id="verify-code-btn">Xác thực mã</button>

  <!-- Firebase App (SDK không phải module) -->
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js"></script>

  <script>
    // Cấu hình Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBBPKJcXjkZ0wUbXNremQuf_R1Z6baYcU0",
      authDomain: "karaoke-3aa8f.firebaseapp.com",
      databaseURL: "https://karaoke-3aa8f-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "karaoke-3aa8f",
      storageBucket: "karaoke-3aa8f.appspot.com",
      messagingSenderId: "652741363415",
      appId: "1:652741363415:web:e33bb49a0be7eed7e09292"
    };

    // Khởi tạo Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Recaptcha Setup
    const setUpRecaptcha = () => {
      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
        'size': 'normal',
        'callback': (response) => {
          console.log("reCAPTCHA verified");
        },
        'expired-callback': () => {
          console.log("reCAPTCHA expired");
        }
      });
      recaptchaVerifier.render();
    };

    // Gửi mã xác minh
    const sendVerificationCode = () => {
      const phoneNumber = document.getElementById('phone-number').value;
      setUpRecaptcha();
      const appVerifier = window.recaptchaVerifier;

      auth.signInWithPhoneNumber(phoneNumber, appVerifier)
        .then((confirmationResult) => {
          window.confirmationResult = confirmationResult;
          alert("Mã xác minh đã được gửi!");
        })
        .catch((error) => {
          console.error("Gửi mã xác minh thất bại:", error);
        });
    };

    // Xác thực mã
    const verifyCode = () => {
      const code = document.getElementById('verification-code').value;
      window.confirmationResult.confirm(code)
        .then((result) => {
          const user = result.user;
          alert("Đăng nhập thành công!");
        })
        .catch((error) => {
          console.error("Xác thực mã thất bại:", error);
        });
    };

    // Event listeners for buttons
    document.getElementById('send-code-btn').addEventListener('click', sendVerificationCode);
    document.getElementById('verify-code-btn').addEventListener('click', verifyCode);
  </script>
</body>
</html>
